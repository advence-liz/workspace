# 支付宝小程序微信小程序分享转发

由于业务需求最近对支付宝小程序和微信小程序的分享功能做了一些了解和尝试，进而写撰写此文作为积累和总结。

## 微信小程序

微信小程序触发分享有两种方式设置`onShareAppMessage`和`button`添加`open-type="share"`属性

## 微信 `onShareAppMessage`

在`page`中添加`onShareAppMessage`方法，然后点击右上角菜单就会有分享选项，如果没有定义`onShareAppMessage`右上角菜单就<u>没有分享选项</u>

### 微信自定义转发内容

| 字段     | 说明                                                                                                     | 默认值                                    | 最低版本 |
| -------- | -------------------------------------------------------------------------------------------------------- | ----------------------------------------- | -------- |
| title    | 转发标题                                                                                                 | 当前小程序名称                            |          |
| path     | 转发路径                                                                                                 | 当前页面 path ，必须是以 / 开头的完整路径 |          |
| imageUrl | 自定义图片路径，可以是本地文件路径、代码包文件路径或者网络图片路径。支持PNG及JPG。显示图片长宽比是 5:4。 | 使用默认截图                              | 1.5.0    |

### 代码示意

```js
page({
  data: {
    shareData: {
      title: '自定义转发标题',
      imageUrl: 'xxxx.jpeg',
      path: '/page/API/pages/share/share'
    }
  },

  onShareAppMessage() {
    return this.data.shareData
  }
})
```

## 转发方式

转发方式只能转发给朋友或者群聊效果如下

![微信分享](http://img002.qufenqi.com/products/96/00/9600925627c289692196af54f4f87947.png)

## 微信动态生成带有用户标识的自定义分享图片

只是单纯的将固定图片分享到群聊显然不够酷炫，现在另一个比较流行的做法是生成一个自定义的分享图片，但是这个流程已经脱离了小程原本的分享功能。
该流程的大体思路是用户触发自定义的分享按钮，然后再小程序端用`canvas`动态的绘制一个带有当前用户标识的图片存储到用户的相册中，之后用户在手动的将图片转发到朋友圈

## 微信 `open-type="share"`

`button`组件设置`open-type="share"`点击`button`触发分享，`open-type="share"`模式如果没有定义`onShareAppMessage`方法也会触发分享

## 支付宝

支付宝小程序触发分享的方式跟微信小程序相同也是两种方式设置`onShareAppMessage`和`button`添加`open-type="share"`属性

## 支付宝`onShareAppMessage`

在`page`中添加`onShareAppMessage`方法，然后点击右上角菜单就会有分享选项，如果没有定义`onShareAppMessage`右上角菜单<u>也有分享选项</u>

### 支付宝自定义转发内容

| 字段     | 类型     | 必填 | 描述                                                                                                              | 最低版本                      |
| -------- | -------- | ---- | ----------------------------------------------------------------------------------------------------------------- | ----------------------------- |
| title    | String   | 是   | 自定义分享标题                                                                                                    | 无                            |
| desc     | String   | 否   | 自定义分享描述：由于分享到微博只支持最大长度 140 个字，因此建议长度不要超过该限制。                               | 无                            |
| path     | String   | 是   | 自定义分享页面的路径，path中的自定义参数可在小程序生命周期的 onLoad方法中获取（参数传递遵循 http get 的传参规则） | 无                            |
| content  | String   | 否   | 自定义吱口令文案，最多28个字符**实际测试无效，咨询支付宝运营人员说是文字吱口令下线了**                            | 1.7.0                         |
| imageUrl | String   | 否   | 自定义分享小图 icon 元素，支持：网络图片路径；apFilePath 路径；相对路径。使用场景详见下方说明                     | 1.4.0                         |
| bgImgUrl | String   | 否   | 自定义分享预览大图，建议尺寸750x825，支持：网络图片路径；apFilePath路径（客户端10.1.58版本开始支持）；相对路径    | （客户端 10.1.58 版本开始支持 |
| success  | Function | 否   | 分享成功后回调                                                                                                    | 1.4.0                         |
| fail     | Function | 否   | 分享失败后回调                                                                                                    | 1.4.0                         |

## 支付宝转发方式

支付宝转发方式花样就比较多了详情可以参考[官方文档](https://docs.alipay.com/mini/api/share_app)

这里单单提一下分享到微信，当用户点击微信的时候支付宝会自动将分享图片存入用户相册（此时支付宝还有文案提示告诉你生成了吱口令去微信粘贴但是现在并不好使，咨询运营人员才知道吱口令下线了）

![支付宝转发效果](http://img002.qufenqi.com/products/00/cb/00cb53e834954728f0d7ebc07031e202.png)

## 关于动态生成带有用户标识的自定义分享图片的尝试

因为支付宝分享会自动截屏保存到相册中，所以当时思考了一下如果当拉起分享窗口的时候页面通过显隐控制的方式，将原本的页面隐藏将规划好的个性化分享页面显示出来，然后小程序进行截图保存，这样既能生成带有用户标识的分享图片，还能无缝衔接到分享流程中，说干就干一顿操作之后在Android手机中测试完美几乎完美，可以天不遂人愿在IOS下失败了故放弃此方案。

## 总结

- 支付宝小程序和微信小程序分享API基本相同只是一些细节不太一样，最大的区别就是微信只能分享到群组或者好友，而支付宝提供了更多的方式
- 遇见问题简单查查文档如果找不到头绪首选求助小程序交流群或者运营人员，因为小程序发展太快了有些问题能找到的资源并不多，而且官方文档更新的也不怎么及时，闷头踩坑的话有些得不偿失。
- 信息具有实效性本文或者网上的其他文章或者官方文档皆不可全信一切以实践为准

![支付宝小程程序开发者群](https://alipaybbs.oss-cn-hangzhou.aliyuncs.com/1903/thread/66_118438_c4450e558bb52e7.png)

## REF

- [微信小程序之生成图片分享](https://cloud.tencent.com/developer/article/1191021)
- [小程序分享，看这篇就够了](https://juejin.im/post/5b4418fee51d4519115cde19)
  